# Airflow Configuration File
# Reference: https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html

[core]
# Airflow home directory
airflow_home = /home/airflow/airflow

# Database connection
sql_alchemy_conn = postgresql://airflow:airflow@postgres:5432/airflow
sql_engine_encoding = utf-8

# Executor
executor = LocalExecutor

# Parallelism settings
parallelism = 32
dag_concurrency = 16
max_active_tasks_per_dag = 16
max_active_runs_per_dag = 3

# Task settings
task_concurrency = 16
dag_file_processor_timeout = 50
task_execution_timeout = 3600

# Logging
base_log_folder = /home/airflow/airflow/logs
log_format = [%%(asctime)s] {%%(filename)s:%%(lineno)d} %%(levelname)s - %%(message)s
simple_log_format = %%(asctime)s %%(levelname)s - %%(message)s

# Security
secure_mode = False
enable_xcom_pickling = False

# Email configuration
email_backend = airflow.providers.sendgrid.utils.sendgrid.SendgridEmailBackend
smtp_host = smtp.sendgrid.net
smtp_port = 587
smtp_user = apikey
smtp_password = ${SENDGRID_API_KEY}

[webserver]
# Web server settings
base_url = http://localhost:8080
web_server_port = 8080
web_server_host = 0.0.0.0
enable_proxy_fix = True
expose_config = True

# Authentication
authenticate = False
auth_backend = airflow.api.auth.backend.default

# UI
default_view = graph
default_dag_run_display_order = asc

[scheduler]
# Scheduler settings
scheduler_heartbeat_sec = 5
scheduler_health_check_threshold = 30
catchup_by_default = False
dag_dir_list_interval = 300

# DAG parsing
max_dagscan_interval = 30
min_file_process_interval = 0
processor_poll_interval = 1

[api]
# API configuration
auth_backend = airflow.api.auth.backend.default

[database]
# Database configuration
load_examples = False

[logging]
# Logging configuration
remote_logging = False
log_retention_days = 30

[celery]
# Celery configuration (if needed)
broker_url = redis://redis:6379/0
result_backend = redis://redis:6379/0

[kubernetes]
# Kubernetes configuration (if needed)
namespace = default
worker_container_repository = apache/airflow
worker_container_tag = 2.7.0-python3.11

[smtp]
# SMTP configuration
smtp_mail_from = noreply@airquality.ai

[webserver_secret_key]
# Generate a secret key for security
# Generate with: python -c 'import os; print(os.urandom(16))'
secret_key = ${AIRFLOW_SECRET_KEY}
